// $SCHEMANAMESQL$.$TABLENAME$.cs

// This file is automatically generated. Please don't change!

// This table has no Identity field, so records are read-only.

using Arena.Common.Data;
using Arena.Common.Errors;
using Arena.Common.JSON;
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Text;

namespace $NAMESPACE$
{
    public partial class $CLASSNAME$
    {
        #region Private Fields

        public static string _tableName = "$SCHEMANAMESQL$.$TABLENAME$";

        private static string _baseQuery = "SELECT * FROM $SCHEMANAMESQL$.$TABLENAME$";
        private static string _firstConj = "WHERE";

        private static string _fieldList;

        // specific properties
$ORDDEFS$

        #endregion

        #region Public Properties

        // specific properties
$PROPERTIES$

        #endregion

        #region Constructors

        static $CLASSNAME$()
        {
            // get list of fields for queries
            _fieldList = GetFieldList();
            // make ordinal positions match field list positions
            SetOrdinals();
            // update base query with exact field names
            _baseQuery = _baseQuery.Replace("*", _fieldList);
			// fix base query as needed
			FixBaseQuery();
        }

        #endregion

        #region Partial Method Declarations

		static partial void FixBaseQuery();

        #endregion

        #region ToString

        public override string ToString()
        {
            JObject result = new JObject()
            {
$TOSTRINGFIELDS$
            };
            return result.ToString();
        }

        #endregion

        #region Get Routines

        public static $CLASSNAME$ Get(DataPlug dp, string subQuery)
        {
            if (dp == null)
            {
                throw new SystemException(ErrorHandler.FixMessage("Argument is null: dp"));
            }
            if (string.IsNullOrEmpty(subQuery))
            {
                throw new SystemException(ErrorHandler.FixMessage("Argument is null: subQuery"));
            }
            $CLASSNAME$ result = null;
            try
            {
                using (SqlConnection dc = SQL.GetDataConnection(dp))
                {
                    dc.Open();
                    string query = $"{_baseQuery} {_firstConj} {subQuery};";
                    SqlCommand cmd = new SqlCommand(query, dc)
                    {
                        CommandType = CommandType.Text,
                        CommandTimeout = SQL.SQLTimeoutSeconds
                    };
                    using (SqlDataReader dr = cmd.ExecuteReader(CommandBehavior.SingleRow))
                    {
                        if (dr.Read())
                        {
                            result = new $CLASSNAME$();
                            FillFields(result, dr);
                        }
                    }
                }
            }
            catch (SqlException ex)
            {
                throw new SystemException(ErrorHandler.FixMessage($"SQL Exception {ex.Number} during Get: {ex.Message}"));
            }
            catch (Exception ex)
            {
                throw new SystemException(ErrorHandler.FixMessage($"Error during Get: {ex.Message}"));
            }
            return result;
        }

        public static List<$CLASSNAME$> GetList(DataPlug dp)
        {
            return GetList(dp, null, null);
        }

        public static List<$CLASSNAME$> GetList(DataPlug dp, string subQuery)
        {
            return GetList(dp, subQuery, null);
        }

        public static List<$CLASSNAME$> GetList(DataPlug dp, string subQuery, string orderBy)
        {
            if (dp == null)
            {
                throw new SystemException(ErrorHandler.FixMessage("Argument is null: dp"));
            }
            List<$CLASSNAME$> result = new List<$CLASSNAME$>();
            $CLASSNAME$ obj;
            try
            {
                using (SqlConnection dc = SQL.GetDataConnection(dp))
                {
                    dc.Open();
                    string query;
                    if (string.IsNullOrEmpty(subQuery) && string.IsNullOrEmpty(orderBy))
                    {
                        query = _baseQuery;
                    }
                    else if (string.IsNullOrEmpty(subQuery))
                    {
                        query = $"{_baseQuery} ORDER BY {orderBy}";
                    }
                    else if (string.IsNullOrEmpty(orderBy))
                    {
                        query = $"{_baseQuery} {_firstConj} {subQuery}";
                    }
                    else
                    {
                        query = $"{_baseQuery} {_firstConj} {subQuery} ORDER BY {orderBy}";
                    }
                    SqlCommand cmd = new SqlCommand(query, dc)
                    {
                        CommandType = CommandType.Text,
                        CommandTimeout = SQL.SQLTimeoutSeconds
                    };
                    using (SqlDataReader dr = cmd.ExecuteReader(CommandBehavior.SingleResult))
                    {
                        while (dr.Read())
                        {
                            obj = new $CLASSNAME$();
                            FillFields(obj, dr);
                            result.Add(obj);
                        }
                    }
                }
            }
            catch (SqlException ex)
            {
                throw new SystemException(ErrorHandler.FixMessage($"SQL Exception {ex.Number} during GetList: {ex.Message}"));
            }
            catch (Exception ex)
            {
                throw new SystemException(ErrorHandler.FixMessage($"Error during GetList: {ex.Message}"));
            }
            return result;
        }

        #endregion

        #region Private Routines

        private static string GetFieldList()
        {
            // get list of all fields for queries
            StringBuilder sb = new StringBuilder();
$GETFIELDLIST$
            return sb.ToString();
        }

        private static void SetOrdinals()
        {
            // make ordinal positions match field list positions
$SETORDINALS$
        }

        private static void FillFields($CLASSNAME$ obj, SqlDataReader dr)
        {
            // fill object from data reader
$FILLFIELDS$
        }

        #endregion

    }
}
